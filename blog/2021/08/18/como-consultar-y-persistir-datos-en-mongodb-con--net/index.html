<!doctype html>
<html lang="es" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.4">
<link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Mario Menj铆var Blog RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Mario Menj铆var Blog Atom Feed">
<link rel="preconnect" href="https://www.google-analytics.com">
<link rel="preconnect" href="https://www.googletagmanager.com">
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-174920898-1"></script>
<script>function gtag(){dataLayer.push(arguments)}window.dataLayer=window.dataLayer||[],gtag("js",new Date),gtag("config","UA-174920898-1",{anonymize_ip:!0})</script><title data-react-helmet="true">C贸mo consultar y persistir datos en MongoDB con .NET | Mario Menj铆var</title><meta data-react-helmet="true" property="og:title" content="C贸mo consultar y persistir datos en MongoDB con .NET | Mario Menj铆var"><meta data-react-helmet="true" name="description" content="En esta entrada, te mostrar茅 como implementar una capa de datos siguiendo el patr贸n repositorio para consultar y persistir datos a una instalaci贸n de MongoDB haciendo uso de C# y el .NET Core Framework."><meta data-react-helmet="true" property="og:description" content="En esta entrada, te mostrar茅 como implementar una capa de datos siguiendo el patr贸n repositorio para consultar y persistir datos a una instalaci贸n de MongoDB haciendo uso de C# y el .NET Core Framework."><meta data-react-helmet="true" property="og:url" content="https://mariomenjr.com/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net"><meta data-react-helmet="true" name="docusaurus_locale" content="es"><meta data-react-helmet="true" name="docusaurus_tag" content="default"><meta data-react-helmet="true" name="keywords" content="consultar mongodb net,insertar documento mongodb net,crud mongodb net csharp,repository pattern mongodb net,mongodb csharp espa帽ol"><meta data-react-helmet="true" property="og:image" content="https://images.unsplash.com/photo-1597852074816-d933c7d2b988?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=512&amp;q=80"><meta data-react-helmet="true" name="twitter:image" content="https://images.unsplash.com/photo-1597852074816-d933c7d2b988?ixid=MnwxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8&amp;ixlib=rb-1.2.1&amp;auto=format&amp;fit=crop&amp;w=512&amp;q=80"><link data-react-helmet="true" rel="shortcut icon" href="/img/favicon.ico"><link data-react-helmet="true" rel="canonical" href="https://mariomenjr.com/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net"><link data-react-helmet="true" rel="alternate" href="https://mariomenjr.com/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net" hreflang="es"><link data-react-helmet="true" rel="alternate" href="https://mariomenjr.com/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.dbcb9299.css">
<link rel="preload" href="/assets/js/runtime~main.4360e302.js" as="script">
<link rel="preload" href="/assets/js/main.6f1a4f9f.js" as="script">
</head>
<body>
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><a href="#" class="skipToContent_1oUP">Saltar al contenido principal</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><img src="https://avatars3.githubusercontent.com/u/1946936?s=460&amp;v=4" alt="Mario Menj铆var Logo" class="themedImage_1VuW themedImage--light_3UqQ navbar__logo"><img src="https://avatars3.githubusercontent.com/u/1946936?s=460&amp;v=4" alt="Mario Menj铆var Logo" class="themedImage_1VuW themedImage--dark_hz6m navbar__logo"><b class="navbar__title">Mario Menj铆var</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/blog">Blog</a><a href="https://forms.formium.io/f/5fe2551f0f24900001bd7abb" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Contacto</a><a class="navbar__item navbar__link" href="/acerca">Acerca</a></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a href="#" class="navbar__item navbar__link"><span><svg viewBox="0 0 20 20" width="20" height="20" aria-hidden="true" style="vertical-align:text-bottom;margin-right:5px"><path fill="currentColor" d="M19.753 10.909c-.624-1.707-2.366-2.726-4.661-2.726-.09 0-.176.002-.262.006l-.016-2.063 3.525-.607c.115-.019.133-.119.109-.231-.023-.111-.167-.883-.188-.976-.027-.131-.102-.127-.207-.109-.104.018-3.25.461-3.25.461l-.013-2.078c-.001-.125-.069-.158-.194-.156l-1.025.016c-.105.002-.164.049-.162.148l.033 2.307s-3.061.527-3.144.543c-.084.014-.17.053-.151.143.019.09.19 1.094.208 1.172.018.08.072.129.188.107l2.924-.504.035 2.018c-1.077.281-1.801.824-2.256 1.303-.768.807-1.207 1.887-1.207 2.963 0 1.586.971 2.529 2.328 2.695 3.162.387 5.119-3.06 5.769-4.715 1.097 1.506.256 4.354-2.094 5.98-.043.029-.098.129-.033.207l.619.756c.08.096.206.059.256.023 2.51-1.73 3.661-4.515 2.869-6.683zm-7.386 3.188c-.966-.121-.944-.914-.944-1.453 0-.773.327-1.58.876-2.156a3.21 3.21 0 011.229-.799l.082 4.277a2.773 2.773 0 01-1.243.131zm2.427-.553l.046-4.109c.084-.004.166-.01.252-.01.773 0 1.494.145 1.885.361.391.217-1.023 2.713-2.183 3.758zm-8.95-7.668a.196.196 0 00-.196-.145h-1.95a.194.194 0 00-.194.144L.008 16.916c-.017.051-.011.076.062.076h1.733c.075 0 .099-.023.114-.072l1.008-3.318h3.496l1.008 3.318c.016.049.039.072.113.072h1.734c.072 0 .078-.025.062-.076-.014-.05-3.083-9.741-3.494-11.04zm-2.618 6.318l1.447-5.25 1.447 5.25H3.226z"></path></svg><span>Espa帽ol</span></span></a><ul class="dropdown__menu"><li><a href="/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active" style="text-transform:capitalize">Espa帽ol</a></li></ul></div><a href="https://github.com/mariomenjr/mariomenjr" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a><div class="react-toggle toggle_3Zt9 react-toggle--disabled"><div class="react-toggle-track" role="button" tabindex="-1"><div class="react-toggle-track-check"><span class="toggle_71bT"></span></div><div class="react-toggle-track-x"><span class="toggle_71bT"></span></div><div class="react-toggle-thumb"></div></div><input type="checkbox" class="react-toggle-screenreader-only" aria-label="Switch between dark and light mode"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper blog-wrapper blog-post-page"><div class="container margin-vert--lg"><div class="row"><aside class="col col--3"><nav class="sidebar_2ahu thin-scrollbar" aria-label="Blog recent posts navigation"><div class="sidebarItemTitle_2hhb margin-bottom--md">Recent posts</div><ul class="sidebarItemList_2xAf"><li class="sidebarItem_2UVv"><a aria-current="page" class="sidebarItemLink_1RT6 sidebarItemLinkActive_12pM" href="/blog/2021/08/18/como-consultar-y-persistir-datos-en-mongodb-con--net">C贸mo consultar y persistir datos en MongoDB con .NET</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/07/29/autenticacion-como-servicio-con-identity-server-4">Autenticaci贸n como servicio con Identity Server 4</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2021/04/04/como-trabajar-con-react-context-y-hooks">C贸mo trabajar con React Context y Hooks</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/09/04/como-validar-formularios-en-react-sin-lagrimas">C贸mo validar formularios en React, sin l谩grimas</a></li><li class="sidebarItem_2UVv"><a class="sidebarItemLink_1RT6" href="/blog/2020/08/14/algoritmos-busqueda-binaria">#Algoritmos: B煤squeda binaria</a></li></ul></nav></aside><main class="col col--7"><article><header><h1 class="blogPostTitle_GeHD">C贸mo consultar y persistir datos en MongoDB con .NET</h1><div class="blogPostData_291c margin-vert--md"><time datetime="2021-08-18T23:31:18.000Z">18 de agosto de 2021</time> 路 17 min de lectura</div><div class="avatar margin-vert--md"><a href="https://github.com/mariomenjr" target="_blank" rel="noopener noreferrer" class="avatar__photo-link avatar__photo"><img src="https://avatars3.githubusercontent.com/u/1946936?s=460&amp;v=4" alt="Mario Menj铆var"></a><div class="avatar__intro"><div class="avatar__name"><a href="https://github.com/mariomenjr" target="_blank" rel="noopener noreferrer">Mario Menj铆var</a></div><small class="avatar__subtitle">Software Engineer</small></div></div></header><div class="markdown"><p>Se ha escrito much铆simo acerca de las ventajas (y desventajas) de las bases de datos NoSQL frente a las SQL. Vagamente, podemos describir a cada uno de estos tipos de bases de datos con una palabra. Flexible, para NoSQL, y Fijo, para SQL. Sin embargo, el tiempo nos ha ense帽ado que ambas son meras herramientas que son preferidas para casos espec铆ficos.</p><p>En esta entrada, te mostrar茅 como implementar una capa de datos siguiendo el patr贸n repositorio para consultar y persistir datos a una instalaci贸n de MongoDB haciendo uso de C# y el .NET Core Framework.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mongodb"></a>MongoDB<a class="hash-link" href="#mongodb" title="Enlace directo al encabezado">#</a></h2><p>Para empezar esta entrada vamos a crear una peque帽a base de datos usando MongoDB. Para esto, podemos usar un servicio online llamado <code>MongoDB Atlas</code> o una imagen de <code>Docker</code> con todo lo necesario para ejecutar nuestra base de datos localmente. Veamos c贸mo hacerlo con Docker.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="contenedor-de-docker"></a>Contenedor de Docker<a class="hash-link" href="#contenedor-de-docker" title="Enlace directo al encabezado">#</a></h3><p>Sin duda, esta opci贸n se te har谩 m谩s util si lo que quieres es una instalaci贸n local. Si haz usado Docker antes, sabr谩s de lo qu茅 te estoy hablando. Si no, ve谩moslo.</p><p>El primer paso es instalar Docker, eso depender谩 de tu sistema.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">Linux</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">macOs</li><li role="tab" tabindex="-1" aria-selected="false" class="tabs__item tabItem_1uMI">Windows</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>Por lo general, hay que completar dos pasos para tener Docker listo en cualquier distro Linux. As铆 lo har铆amos en Manjaro:</p><ol><li>Instalar el paquete desde los repositorios</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> pacman -S docker</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><ol start="2"><li>Una vez instalado, debemos <code>habilitarlo</code> e <code>iniciarlo</code>:</li></ol><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl start docker</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> systemctl </span><span class="token builtin class-name">enable</span><span class="token plain"> docker</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Ahora puedes ejecutar Docker como <code>root</code>. Opcionalmente, puedes agregar tu usuario al grupo de Docker. De este modo, puedes ejecutar contenedores sin necesidad del comando <code>sudo</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">usermod</span><span class="token plain"> -aG docker </span><span class="token environment constant" style="color:#36acaa">$USER</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>And, to make our lives easier, let&#x27;s install <code>docker-compose</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">sudo</span><span class="token plain"> pacman -S docker-compose</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div></div><div role="tabpanel" hidden=""><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">brew </span><span class="token function" style="color:#d73a49">install</span><span class="token plain"> docker docker-compose docker-machine xhyve docker-machine-driver-xhyve</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>M谩s detalles <a href="https://pilsniak.com/how-to-install-docker-on-mac-os-using-brew" target="_blank" rel="noopener noreferrer">aqu铆</a>.</p></div><div role="tabpanel" hidden=""><p>Sigue las siguientes <a href="https://docs.docker.com/docker-for-windows/install/#install-docker-desktop-on-windows" target="_blank" rel="noopener noreferrer">instrucciones</a>.</p></div></div></div><p>Ya que Docker est谩 listo, el siguiente paso es instalar y ejecutar un contenedor que tenga todo lo necesario para alojar una base de datos MongoDB. </p><p>Por suerte, existe una <a href="https://hub.docker.com/_/mongo" target="_blank" rel="noopener noreferrer">imagen oficial</a> que cumple con esas caracter铆sticas. </p><p>Para hacer crear un contenedor apartir de esta imagen, seguiremos los pasos en la documentaci贸n oficial. Crearemos el siguiente archivo en el directorio que prefieras.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">~/Samples/docker-mongo/docker-compose.yml</div><div class="codeBlockContent_hGly yml"><pre tabindex="0" class="prism-code language-yml codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Usa root/password como usuario/contrase帽a</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">version</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&#x27;3.1&#x27;</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">services</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 27017</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">27017</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MONGO_INITDB_ROOT_USERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">MONGO_INITDB_ROOT_PASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token key atrule" style="color:#00a4db">mongo-express</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">image</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongo</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">express</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">restart</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> always</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">ports</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> 8081</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8081</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">environment</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ME_CONFIG_MONGODB_ADMINUSERNAME</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> root</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ME_CONFIG_MONGODB_ADMINPASSWORD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> password</span></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">ME_CONFIG_MONGODB_URL</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> mongodb</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//root</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">password@mongo</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">27017/</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Una vez creado, es hora de construir nuestro contendor. Para eso, nos posicionamos en el directorio.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> ~/Samples/docker-mongo</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Y ejecutamos <code>docker-compose up</code>:</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">docker-compose up</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Si todo sali贸 bien, deber铆as ver las siguientes l铆neas:</p><blockquote><p>mongo-express_1  | Mongo Express server listening at <a href="http://0.0.0.0:8081" target="_blank" rel="noopener noreferrer">http://0.0.0.0:8081</a> <br>
mongo-express_1  | Server is open to allow connections from anyone (0.0.0.0) <br>
mongo-express_1  | basicAuth credentials are &quot;admin:pass&quot;, it is recommended(...) <br></p></blockquote><p>Si llevas tiempo desarrollando software, seguro recordar谩s a PhpMyAdmin. La imagen oficial de <em>MongoDB</em> provee un servicio muy parecido llamado <code>Mongo Express</code>, dir铆gete a <a href="http://localhost:8081" target="_blank" rel="noopener noreferrer">http://localhost:8081</a> para acceder.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="preparando-el-ejemplo"></a>Preparando el ejemplo<a class="hash-link" href="#preparando-el-ejemplo" title="Enlace directo al encabezado">#</a></h2><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="base-de-datos"></a>Base de datos<a class="hash-link" href="#base-de-datos" title="Enlace directo al encabezado">#</a></h3><p>Al acceder a <em>Mongo Express</em>, lo primero que haremos ser谩 crear una base de datos.</p><figure class="md-captioned-image"><img src="/assets/images/007-mongo-express-cfcabbb7dab1925a2a85a7c86adaadf5.png" alt="Mongo Express"><figcaption>Instancia local de Mongo Express.</figcaption></figure><figure class="md-captioned-image"><img src="/assets/images/007-db-created-5cef02fef34aeb1f6a624c2faace941e.png" alt="DB Created"><figcaption>Base de datos creada.</figcaption></figure><p>En el siguiente paso crearemos una collecci贸n.</p><figure class="md-captioned-image"><img src="/assets/images/007-collection-created-b08ad966d3d1a1ab7e2ad4fc8f46dcbb.png" alt="Collection Created"><figcaption>Creating Collection.</figcaption></figure><p>Y por 煤ltimo el primer documento, siguiendo un esquema sencillo. nicamente una propiedad: <code>username</code>.</p><figure class="md-captioned-image"><img src="/assets/images/007-new-document-3dcfc7e77ff08a9f0c32160c7ebf5833.png" alt="Document Created"><figcaption>Nuevo documento creado.</figcaption></figure><blockquote><p>En este ejemplo, tenemos que crear un usuario distinto a <code>root</code> para poder consultar y persistir datos desde la aplicaci贸n a trav茅s MongoDB.Driver para .NET. La forma m谩s sencilla de logralo es a trav茅s de <a href="https://robomongo.org/" target="_blank" rel="noopener noreferrer">Robo 3T</a>.</p></blockquote><figure class="md-captioned-image"><img src="/assets/images/007-create-user-e0f4b4669de0a4e5dea4057ff1a66193.png" alt="Sample-&gt;Users"><figcaption>Click derecho en Sample-&gt;Users.</figcaption></figure><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="api-en-net"></a>API en .NET<a class="hash-link" href="#api-en-net" title="Enlace directo al encabezado">#</a></h3><p>Lo siguiente que haremos ser谩 crear una API en .NET para poder consumir la base de datos a trav茅s de endpoints. En realidad podr铆a ser un proyecto de consola, una librer铆a, o lo qu茅 tu quieras.</p><div class="tabs-container"><ul role="tablist" aria-orientation="horizontal" class="tabs"><li role="tab" tabindex="0" aria-selected="true" class="tabs__item tabItem_1uMI tabs__item--active">.NET CLI</li></ul><div class="margin-vert--md"><div role="tabpanel"><p>Primero creamos el directorio de la soluci贸n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> ~/Samples/dotnet-webapi/Sample.API </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token builtin class-name">cd</span><span class="token plain"> ~/Samples/dotnet-webapi/Sample.API</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Una vez ah铆, creamos el proyecto API de <code>dotnet</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet new webapi</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Ahora creamos una soluci贸n, para que nuestro proyecto sea amigable con un IDE (en mi caso, Rider).</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;</span><span class="token plain"> dotnet new sln -n Sample</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><blockquote><p>The template &quot;Solution File&quot; was created successfully.</p></blockquote><p>Y a帽adimos nuestro reci茅n creado proyecto <code>Sample.API</code> a la soluci贸n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet sln </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.API/Sample.API.csproj</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><blockquote><p>The template &quot;Solution File&quot; was created successfully.</p></blockquote><p>Ejecutamos nuestro proyecto para asegurarnos que hicimos todo bien.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet run --project Sample.API</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Deber铆as ver una lista JSON en ese enlace: <a href="https://localhost:5001/WeatherForecast" target="_blank" rel="noopener noreferrer">https://localhost:5001/WeatherForecast</a>.</p></div></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mongodbdriver"></a>MongoDB.Driver<a class="hash-link" href="#mongodbdriver" title="Enlace directo al encabezado">#</a></h3><p>Por 煤ltimo, instalaremos el driver oficial de MongoDB para .NET con el cu谩l podremos consultar e insertar datos. Haz click en el siguiente <a href="https://www.nuget.org/packages/MongoDB.Driver/" target="_blank" rel="noopener noreferrer">link</a> para determinar la 煤ltima versi贸n estable y poder ejecutar el comando de abajo.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.API/Sample.API.csproj package MongoDB.Driver -v </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">VERSION</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Una vez instalado, crearemos un nuevo endpoint para conectarnos a MongoDB y validar la instalaci贸n.</p><p>El primer paso es crear un controlador llamado <code>ApiController</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">touch</span><span class="token plain"> Sample.API/Controllers/ApiController.cs</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Con el siguiente contenido:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.API/Controllers/ApiController.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.AspNetCore.Mvc;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Driver;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.API.Controllers</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Route(&quot;[controller]&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [ApiController]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class ApiController : ControllerBase</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        [HttpGet, Route(&quot;[action]&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public JsonResult GetUsers()</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var client = new MongoClient(&quot;mongodb://mariomenjr:mariomenjr@localhost:27017/sample&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var database = client.GetDatabase(&quot;sample&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var users = database.GetCollection&lt;object&gt;(&quot;users&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var datos = users.AsQueryable().Select(s =&gt; s);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new JsonResult(datos);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Al dirigirnos al nuevo endpoint, veremos que nuestro 煤nico usuario registrado es devuelto en formato JSON.</p><figure class="md-captioned-image"><img src="/assets/images/007-ApiGetUsers-f455d5ad9ca1f8af801fe3d424119d96.png" alt="Consulta Users MongoDB"><figcaption>Consultando colecci贸n Users de MongoDB.</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="repository-pattern"></a>Repository Pattern<a class="hash-link" href="#repository-pattern" title="Enlace directo al encabezado">#</a></h2><p>Con nuestra base de datos y API listas, el siguiente paso para consumir nuestra base de datos es crear nuestro repositorio.</p><p>El <em>Repository Pattern</em> (o, Patr贸n de Repositorio en espa帽ol) es una estrategia en desarrollo de software para abstraer el acceso de datos en nuestra aplicaci贸n. En palabras m谩s simples, es el c贸digo que tiene como responsabilidad exclusiva el consultar y guardar datos en una aplicaci贸n.</p><p>Sin capa de abstracci贸n, podr铆amos encontrarnos que el c贸digo de interacci贸n con la base de datos es parte de la l贸gica de negocio de tu aplicaci贸n.</p><figure class="md-captioned-image"><img src="data:image/png;base64,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" alt="Non Repository Diagram"><figcaption>Diagrama de acceso a datos sin una capa de abstracci贸n.</figcaption></figure><p>Algo similar a esto:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.API/Controllers/ApiController.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// ... M茅todo GetUsers  </span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">// C贸digo para conectarnos a la base de datos</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">var client = new MongoClient(&quot;mongodb://mariomenjr:mariomenjr@localhost:27017/sample&quot;);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">var database = client.GetDatabase(&quot;sample&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">// C贸digo de consulta de datos</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">var users = database.GetCollection&lt;object&gt;(&quot;users&quot;);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">var datos = users.AsQueryable().Select(s =&gt; s);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// C贸digo de aplicaci贸n que devuelve datos como JSON</span></span><span class="token-line" style="color:#393A34"><span class="token plain">return new JsonResult(datos);</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Podr铆as argumentar que esta pieza de c贸digo <em>hace el trabajo</em>, 驴Por qu茅 querr铆amos abstraerlo? Claro, es una pregunta v谩lida. Hay muchas razones por las qu茅 nos conviene m谩s tener una capa dedicada al acceso a datos que repetir c贸digo por todos lados.</p><figure class="md-captioned-image"><img src="data:image/png;base64,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" alt="Repository Diagram"><figcaption>Diagrama de acceso a datos con el Patr贸n de Repositorio</figcaption></figure><p>En primera, las aplicaciones nunca est谩n terminadas. Siempre habr谩 una actualizaci贸n por hacer. Por ejemplo, 驴Qu茅 pasa si agregas un nuevo campo a la tabla <code>Users</code>? Tendr铆as que reescribir cada parte de tu aplicaci贸n d贸nde accedas a estos datos. Esto implica no solo la reescritura, pero una revalidaci贸n de toda la aplicaci贸n. Nada bonito, cr茅eme.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="sampledal"></a>Sample.DAL<a class="hash-link" href="#sampledal" title="Enlace directo al encabezado">#</a></h2><p>Si has trabajado con .NET antes, seguro habr谩s escuchado la palabra DAL. Aunque no es propia de este lenguaje de programaci贸n, es muy com煤n ver esta abstracci贸n en proyectos con esta tecnolog铆a. No es raro ver soluciones con m谩s de un proyecto, y uno de los cu谩les lleve en su nombre el sufijo <code>.DAL</code> o <code>Data Access Layer</code> (o <em>capa de acceso a datos</em> en espa帽ol).</p><p>Por lo general, las soluciones de .NET que implementan un proyecto .DAL consumen datos de una base de datos en Microsoft SQL Server. En nuestro caso, haremos algo muy parecido pero con MongoDB. Let&#x27;s have fun.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="cortana-crea-un-segundo-proyecto"></a>Cortana, crea un segundo proyecto<a class="hash-link" href="#cortana-crea-un-segundo-proyecto" title="Enlace directo al encabezado">#</a></h3><p>Vamos a crear un segundo proyecto dentro de nuestra soluci贸n, ser谩 nuestra <code>DAL</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> dotnet new classlib</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Y ahora lo a帽adimos a nuestra soluci贸n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token builtin class-name">cd</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">..</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> dotnet sln </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.DAL/Sample.DAL.csproj</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="instalamos-mongodbdriver-de-nuevo"></a>Instalamos MongoDB.Driver, de nuevo<a class="hash-link" href="#instalamos-mongodbdriver-de-nuevo" title="Enlace directo al encabezado">#</a></h3><p>Esta vez en nuestro proyecto DAL. Para mayor detalle, <a href="#mongodbdriver">MongoDB.Driver</a>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.DAL/Sample.DAL.csproj package MongoDB.Driver -v </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">VERSION</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="referencia-dal-en-api"></a>Referencia DAL en API<a class="hash-link" href="#referencia-dal-en-api" title="Enlace directo al encabezado">#</a></h3><p>Nuestra API debe ser capaz de consumir nuestro proyecto DAL.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.API/Sample.API.csproj reference Sample.DAL/Sample.DAL.csproj</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="estructura-del-paquete-dal"></a>Estructura del paquete DAL<a class="hash-link" href="#estructura-del-paquete-dal" title="Enlace directo al encabezado">#</a></h3><p>Nuestro paquete <em>DAL</em> tendr谩 la siguiente estructura. En el directorio <code>Mongo</code>, escribiremos c贸digo necesario para conectarnos a la base de datos y para proveer un ancla en nuestro proyecto, el API. Por otro lado, el directorio <code>Repository</code> albergar谩 c贸digo necesario por consumir datos de cada colecci贸n.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly"><pre tabindex="0" class="prism-code language-undefined codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain"> Sample.DAL</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Mongo</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| |  Extensions</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| |  Connection</span></span><span class="token-line" style="color:#393A34"><span class="token plain">  Repository</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| |  Managers</span></span><span class="token-line" style="color:#393A34"><span class="token plain">| |  IServices</span></span><span class="token-line" style="color:#393A34"><span class="token plain">|  Entidades // Podr铆amos crear un tercer proyecto apartir de este directorio, por simplicidad lo dejaremos aqu铆.</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Empecemos por crear los dos directorios con mayor jerarqu铆a en este proyecto.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Mongo </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Repository </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Entidades</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Y luego todos los dem谩s.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Mongo/Extensions </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Mongo/Connections </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Repository/Managers </span><span class="token operator" style="color:#393A34">&amp;&amp;</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">mkdir</span><span class="token plain"> Sample.DAL/Repository/IServices</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="mongodb-connecci贸n-e-interfaz"></a>MongoDB, Connecci贸n e Interfaz<a class="hash-link" href="#mongodb-connecci贸n-e-interfaz" title="Enlace directo al encabezado">#</a></h3><p>Empezamos por la configuraci贸n, el par de archivos <code>IMongoSettings.cs</code> y <code>MongoSettings.cs</code> nos ayudar谩 a contener el nombre de la base de datos y la cadena de conecci贸n.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Connections/IMongoSettings.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Connections</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public interface IMongoSettings</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string DatabaseName { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string ConnectionString { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Connections/MongoSettings.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Connections</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class MongoSettings : IMongoSettings</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string DatabaseName { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string ConnectionString { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Conforme la base de datos crezca, cada colecci贸n estar谩 formada de propiedades con un significado espec铆fico. Es muy importante mantener un modelo de cada colecci贸n en la base datos. En C#, esto lo lograremos creando una clase que refleje los miembros de cada colecci贸n y nos permita manipular estos datos de manera sencilla.</p><p>A pesar de que estos modelos pueden variar much铆simo uno del otro, con MongoDB tenemos la certeza de que siempre existir谩 una propiedad <code>_id</code> en cada colecci贸n. Propia de c贸mo MongoDB organiza los datos. Es por esto que el siguiente paso en el desarrollo de la DAL es crear un <em>tipo de dato</em> que asuma la existencia de esta propiedad y nos de la pauta de identificar un modelo de cualquier otro tipo de dato.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Entidades/IDocument.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Bson;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Bson.Serialization.Attributes;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Entidades</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public interface IDocument</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        [BsonId]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        [BsonRepresentation(BsonType.String)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ObjectId Id { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public DateTimeOffset CreatedOn { get; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Entidades/Document.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Bson;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Entidades</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public abstract class Document : IDocument </span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public ObjectId Id { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public DateTimeOffset CreatedOn =&gt; Id.CreationTime.ToLocalTime();</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Una pieza cr铆tica del patr贸n de repositorio es el poder definir una plantilla de los m茅todos y propiedades que ser谩n necesarios para poder consultar o persistir datos en cada colecci贸n de MongoDB. Para eso, definimos la interfaz <code>IMongoRepository&lt;TDocument&gt;</code>. En ella, daremos forma a nuestro repositorio de datos.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Connections/IMongoRepository.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq.Expressions;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading.Tasks;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Entidades;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Connections</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public interface IMongoRepository&lt;TDocument&gt; where TDocument : IDocument</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        IQueryable&lt;TDocument&gt; AsQueryable();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        IEnumerable&lt;TDocument&gt; FilterBy(</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        IEnumerable&lt;TProjected&gt; FilterBy&lt;TProjected&gt;(</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression,</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, TProjected&gt;&gt; projectionExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        TDocument FindOne(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task&lt;TDocument&gt; FindOneAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        TDocument FindById(string id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task&lt;TDocument&gt; FindByIdAsync(string id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        IEnumerable&lt;TDocument&gt; Find();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task&lt;IEnumerable&lt;TDocument&gt;&gt; FindAsync();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void InsertOne(TDocument document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task InsertOneAsync(TDocument document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void InsertMany(ICollection&lt;TDocument&gt; documents);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task InsertManyAsync(ICollection&lt;TDocument&gt; documents);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void ReplaceOne(TDocument document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task ReplaceOneAsync(TDocument document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void DeleteOne(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task DeleteOneAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void DeleteById(string id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task DeleteByIdAsync(string id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        void DeleteMany(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        Task DeleteManyAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Antes de implementar la plantilla, crearemos un atributo que nos permitir谩 definir el nombre de la colecci贸n para nuestro repositorio.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Connections</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [AttributeUsage(AttributeTargets.Class, Inherited = false)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class BsonCollectionAttribute : Attribute</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string CollectionName { get; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public BsonCollectionAttribute(string collectionName)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            this.CollectionName = collectionName;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Ya que tenemos este atributo y la plantilla, es hora de implementarla. Vamos a empezar por el <code>constructor</code> que es d贸nde configuraremos la conexi贸n a la base de datos.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Connections/MongoRepository.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using System;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Collections.Generic;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Linq.Expressions;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using System.Threading.Tasks;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Mongo.Settings;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Identity.Entities.Utils.Attributes;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Bson;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Bson.Serialization.Conventions;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using MongoDB.Driver;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Connections</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class MongoRepository&lt;TDocument&gt; : IMongoRepository&lt;TDocument&gt; where TDocument : IDocument</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        private readonly IMongoCollection&lt;TDocument&gt; _collection;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        /* </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         * Setups connection to MongoDB</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         *</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         **/</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public MongoRepository(IMongoSettings settings)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            // Aplica la nomenclatura `camelCase` al momento de parsear el Modelo</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            ConventionRegistry.Register(&quot;camelCase&quot;, new ConventionPack {new CamelCaseElementNameConvention()}, t =&gt; true);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            // Configura un MongoClient y la conecci贸n a la base de datos</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var client = new MongoClient(settings.ConnectionString);  // mongodb://mariomenjr:mariomenjr@localhost:27017/sample</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var database = client.GetDatabase(settings.DatabaseName); // sample</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            // Configura el manejador de la colecci贸n</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var collectionName = this.GetCollectionName(typeof(TDocument));</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            this._collection = database.GetCollection&lt;TDocument&gt;(collectionName);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        /* </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         * Gets the collection name from a Model</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         *</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">         **/</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        private protected string GetCollectionName(Type documentType)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return ((BsonCollectionAttribute) documentType.GetCustomAttributes(</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                    typeof(BsonCollectionAttribute),</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                    true)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                .FirstOrDefault())?.CollectionName;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Una vez tenemos la conexi贸n configurada, es hora de cubrir los m茅todos de interacci贸n con la base de datos. Nos referimos al CRUD. Crear, leer, actualizar y eliminar, por sus siglas en ingl茅s.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Connections/MongoRepository.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual IQueryable&lt;TDocument&gt; AsQueryable()</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.AsQueryable();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual IEnumerable&lt;TDocument&gt; FilterBy(</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.Find(filterExpression).ToEnumerable();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual IEnumerable&lt;TProjected&gt; FilterBy&lt;TProjected&gt;(</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression,</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            Expression&lt;Func&lt;TDocument, TProjected&gt;&gt; projectionExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.Find(filterExpression).Project(projectionExpression).ToEnumerable();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual TDocument FindOne(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.Find(filterExpression).FirstOrDefault();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual Task&lt;TDocument&gt; FindOneAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt; _collection.Find(filterExpression).FirstOrDefaultAsync());</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual TDocument FindById(string id)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var objectId = new ObjectId(id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, objectId);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.Find(filter).SingleOrDefault();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual Task&lt;TDocument&gt; FindByIdAsync(string id)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                var objectId = new ObjectId(id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, objectId);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                return _collection.Find(filter).SingleOrDefaultAsync();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual IEnumerable&lt;TDocument&gt; Find()</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return _collection.Find(Builders&lt;TDocument&gt;.Filter.Empty).ToList();</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual Task&lt;IEnumerable&lt;TDocument&gt;&gt; FindAsync()</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                return _collection.Find(Builders&lt;TDocument&gt;.Filter.Empty).ToListAsync().ContinueWith(task =&gt; task.Result.AsEnumerable());</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual void InsertOne(TDocument document)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.InsertOne(document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual Task InsertOneAsync(TDocument document)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt; _collection.InsertOneAsync(document));</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public void InsertMany(ICollection&lt;TDocument&gt; documents)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.InsertMany(documents);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual async Task InsertManyAsync(ICollection&lt;TDocument&gt; documents)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            await _collection.InsertManyAsync(documents);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public void ReplaceOne(TDocument document)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, document.Id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.FindOneAndReplace(filter, document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public virtual async Task ReplaceOneAsync(TDocument document)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, document.Id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            await _collection.FindOneAndReplaceAsync(filter, document);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public void DeleteOne(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.FindOneAndDelete(filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public Task DeleteOneAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt; _collection.FindOneAndDeleteAsync(filterExpression));</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public void DeleteById(string id)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var objectId = new ObjectId(id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, objectId);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.FindOneAndDelete(filter);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public Task DeleteByIdAsync(string id)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                var objectId = new ObjectId(id);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                var filter = Builders&lt;TDocument&gt;.Filter.Eq(doc =&gt; doc.Id, objectId);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">                _collection.FindOneAndDeleteAsync(filter);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            });</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public void DeleteMany(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            _collection.DeleteMany(filterExpression);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public Task DeleteManyAsync(Expression&lt;Func&lt;TDocument, bool&gt;&gt; filterExpression)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return Task.Run(() =&gt; _collection.DeleteManyAsync(filterExpression));</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Con esto, tenemos listo el esqueleto de nuestro repositorio de datos. El siguiente paso es aplicarlo a cada colecci贸n.</p><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="entidades"></a>Entidades<a class="hash-link" href="#entidades" title="Enlace directo al encabezado">#</a></h3><p>Para poder crear un repositorio, necesitamos los modelos. En nuestro caso, solo tenemos una colecci贸n por lo qu茅 solo crearemos un modelo.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Entidades/User.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Mongo.Connections;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Entidades</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [BsonCollection(&quot;users&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public partial class User : Document</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public string Username { get; set; }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h3><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="iservice-y-manager"></a>IService y Manager<a class="hash-link" href="#iservice-y-manager" title="Enlace directo al encabezado">#</a></h3><p>Para terminar de configurar nuestro repositorio basta con aplicar lo qu茅 ya escribimos en el archivo <code>Sample.DAL/Mongo/Connections/MongoRepository.cs</code> a cada colecci贸n. Es aqu铆 d贸nde definiremos el c贸mo accederemos o modificaremos la base de datos. C贸mo buena pr谩ctica, crearemos para cada colecci贸n una plantilla y una implementaci贸n, o en otras palabras un <code>IService</code> y un <code>Manager</code>.</p><p>En nuestra base de datos de MongoDB solo tenemos una colecci贸n, por lo qu茅 ser谩 muy sencillo implementar este par.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Repository/IServices/IUserService.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Entidades;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Mongo.Connections;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Repository.IServices</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public interface IUserService : IMongoRepository&lt;User&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Repository/Managers/UsersManager.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Entidades;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Mongo.Connections;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Repository.IServices;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Repository.Managers</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class UserManager : MongoRepository&lt;User&gt;, IUserService</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public UserManager(IMongoSettings settings) : base(settings)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {}</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="dependency-injection"></a>Dependency Injection<a class="hash-link" href="#dependency-injection" title="Enlace directo al encabezado">#</a></h2><p>Antes de configurar la inyecci贸n de dependencias tenemos que instalar un paquete de extensiones para la configuraci贸n. El paquete se encuentra en el repositorio de NuGet. Revisa cu谩l es la 煤ltima versi贸n disponible en este <a href="https://www.nuget.org/packages/Microsoft.Extensions.Options.ConfigurationExtensions/" target="_blank" rel="noopener noreferrer">enlace</a> y ejecuta el siguiente comando. </p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly bash"><pre tabindex="0" class="prism-code language-bash codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">dotnet </span><span class="token function" style="color:#d73a49">add</span><span class="token plain"> Sample.DAL/Sample.DAL.csproj package Microsoft.Extensions.Options.ConfigurationExtensions --version </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">VERSION</span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Lleg贸 la hora de crear una extensi贸n propia de nuestro paquete. Dejaremos toda la complejidad aqu铆, y en nuestra API simplemente llamaremos a un m茅todo.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.DAL/Mongo/Extensions/MongoExtension.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.Configuration;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.DependencyInjection;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Microsoft.Extensions.Options;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Mongo.Connections;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Repository.IServices;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">using Sample.DAL.Repository.Managers;</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.DAL.Mongo.Extensions</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public static class MongoExtension</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        public static IServiceCollection AddMongoDb(this IServiceCollection services, IConfigurationSection mongoSettings)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.Configure&lt;MongoSettings&gt;(mongoSettings);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.AddSingleton&lt;IMongoSettings&gt;(srvProvider =&gt;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">                srvProvider.GetRequiredService&lt;IOptions&lt;MongoSettings&gt;&gt;().Value);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            services.AddTransient&lt;IUserService, UserManager&gt;();</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return services;</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Y en nuestra API, configuramos lo siguiente:</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.API/Startup.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">    // ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public void ConfigureServices(IServiceCollection services)</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        services.AddMongoDb(Configuration.GetSection(&quot;MongoSettings&quot;));</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Para que lo anterior tenga sentido, agregamos esto al archivo <code>appsettings.json</code>.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly json"><pre tabindex="0" class="prism-code language-json codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic">// ...</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token property" style="color:#36acaa">&quot;MongoSettings&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;ConnectionString&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;mongodb://mariomenjr:mariomenjr@localhost:27017/sample&quot;</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">    </span><span class="token property" style="color:#36acaa">&quot;DatabaseName&quot;</span><span class="token operator" style="color:#393A34">:</span><span class="token plain"> </span><span class="token string" style="color:#e3116c">&quot;sample&quot;</span><span class="token plain"></span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">}</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><blockquote><p>Por ning煤n motivo debemos compartir estas credenciales en alg煤n controlador de version p煤blico. Para un proyecto, recomiendo leer sobre <a href="https://docs.microsoft.com/en-us/aspnet/core/security/app-secrets?view=aspnetcore-5.0" target="_blank" rel="noopener noreferrer"><code>secrets.json</code></a></p></blockquote><p>Por 煤ltimo, inyectamos la dependencia en el API.</p><div class="codeBlockContainer_K1bP"><div style="color:#393A34;background-color:#f6f8fa" class="codeBlockTitle_eoMF">Sample.API/Controllers/ApiController.cs</div><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">// ...</span></span><span class="token-line" style="color:#393A34"><span class="token plain">namespace Sample.API.Controllers</span></span><span class="token-line" style="color:#393A34"><span class="token plain">{</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [Route(&quot;[controller]&quot;)]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    [ApiController]</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    public class ApiController : ControllerBase</span></span><span class="token-line" style="color:#393A34"><span class="token plain">    {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        private readonly IUserService _userService;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public ApiController(IUserService userService)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            this._userService = userService;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="crud"></a>CRUD<a class="hash-link" href="#crud" title="Enlace directo al encabezado">#</a></h2><p>Una vez hemos implementado el patr贸n de repositorio para acceder y persistir datos, un CRUD es tan sencillo como lo siguiente.</p><div class="codeBlockContainer_K1bP"><div class="codeBlockContent_hGly csharp"><pre tabindex="0" class="prism-code language-csharp codeBlock_23N8 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_39YC"><span class="token-line" style="color:#393A34"><span class="token plain">        // ...</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        [HttpGet, Route(&quot;[action]&quot;)]</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public JsonResult GetUsers()</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return new JsonResult(this._userService.Find());</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Este es el c贸digo que nos permiti贸 consultar la lista de usuario al inicio del Post.</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            // Ya no lo necesitamos y podemos borrarlo.</span></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var client = new MongoClient(&quot;mongodb://mariomenjr:mariomenjr@localhost:27017/sample&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var database = client.GetDatabase(&quot;sample&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            var users = database.GetCollection&lt;object&gt;(&quot;users&quot;);</span></span><span class="token-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line" style="color:#393A34"><span class="token plain">            return new JsonResult(users.AsQueryable().Select(s =&gt; s));</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain" style="display:inline-block">
</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        [HttpPost, Route(&quot;[action]&quot;)]</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public JsonResult AddUser(string username)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var newUser = new User {Username = username};</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            this._userService.InsertOne(newUser);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return new JsonResult(newUser);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        [HttpPut, Route(&quot;[action]&quot;)]</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public JsonResult UpdateUser(string oldUsername, string newUsername)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            var user = this._userService.FindOne(x =&gt; x.Username == oldUsername);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            user.Username = newUsername;</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            this._userService.ReplaceOne(user);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return new JsonResult(user);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        [HttpDelete, Route(&quot;[action]&quot;)]</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        public JsonResult DeleteUser(string username)</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        {</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            this._userService.DeleteOne(x =&gt; x.Username == username);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            </span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">            return new JsonResult(username);</span></span><span class="token-line docusaurus-highlight-code-line" style="color:#393A34"><span class="token plain">        }</span></span><span class="token-line" style="color:#393A34"><span class="token plain">        //...</span></span></code></pre><button type="button" aria-label="Copiar c贸digo al portapaples" class="copyButton_Ue-o clean-btn">Copiar</button></div></div><p>Listo, ya tenemos una interfaz para consultar y persistir datos en la colecci贸n <em>Users</em>.</p><figure class="md-captioned-image"><img src="/assets/images/007-crud-a26f6f8f7e7d0e1b623185ffef325526.png" alt="CRUD"><figcaption>CRUD para colecci贸n Users</figcaption></figure><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="conclusi贸n"></a>Conclusi贸n<a class="hash-link" href="#conclusi贸n" title="Enlace directo al encabezado">#</a></h2><p>Espero que este post te haya sido de mucha ayuda. Despu茅s de implementar el patr贸n de repositorio, es muy sencillo escalar cualquier consulta a la base de datos. No necesitamos conocer ning煤n detalle de conecci贸n, ya que eso es manejado propiamente por esta nueva capa.</p><p>La ventaja de esto es que si la base de datos sufre alg煤n cambio, no debemos ir a cada parte de la aplicaci贸n para implementarlos. nicamente nuestro paquete DAL sufrir谩 los cambios. Reduciendo ambos el tiempo de programaci贸n y pruebas.</p><h2><a aria-hidden="true" tabindex="-1" class="anchor enhancedAnchor_2LWZ" id="referencias"></a>Referencias<a class="hash-link" href="#referencias" title="Enlace directo al encabezado">#</a></h2><ul><li><a href="https://docs.mongodb.com/drivers/csharp/" target="_blank" rel="noopener noreferrer">MongoDB C#/.NET Driver</a></li><li><a href="https://makingloops.com/why-should-you-use-the-repository-pattern/" target="_blank" rel="noopener noreferrer">The WHY Series: Why should you use the repository pattern?</a></li><li><a href="https://www.mongodb.com/blog/post/quick-start-c-and-mongodb--read-operations" target="_blank" rel="noopener noreferrer">Quick Start: C# and MongoDB - Read Operations</a></li><li><a href="https://docs.microsoft.com/en-us/dotnet/core/tutorials/library-with-visual-studio-code" target="_blank" rel="noopener noreferrer">Tutorial: Create a .NET class library using Visual Studio Code</a></li></ul></div><footer class="row docusaurus-mt-lg blogPostDetailsFull_3kfx"><div class="col"><b>Etiquetas:</b><a class="margin-horiz--sm" href="/blog/tags/csharp">csharp</a><a class="margin-horiz--sm" href="/blog/tags/mongodb">mongodb</a><a class="margin-horiz--sm" href="/blog/tags/repository-pattern">repository pattern</a><a class="margin-horiz--sm" href="/blog/tags/patron-de-repositorio">patr贸n de repositorio</a><a class="margin-horiz--sm" href="/blog/tags/dao">dao</a><a class="margin-horiz--sm" href="/blog/tags/data-layer">data layer</a></div><div class="col margin-top--sm"><a href="https://github.com/mariomenjr/mariomenjr/edit/main/blog/2021-08-18_como-consultar-y-persistir-datos-en-mongodb-con-net.md" target="_blank" rel="noreferrer noopener"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_2_ui" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Editar est谩 p谩gina</a></div></footer></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Navegaci贸n de la p谩gina de publicaciones del blog "><div class="pagination-nav__item"></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/blog/2021/07/29/autenticacion-como-servicio-con-identity-server-4"><div class="pagination-nav__sublabel">Publicaci贸n m谩s antigua</div><div class="pagination-nav__label">Autenticaci贸n como servicio con Identity Server 4 禄</div></a></div></nav></main><div class="col col--2"><div class="tableOfContents_35-E thin-scrollbar"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#mongodb" class="table-of-contents__link">MongoDB</a><ul><li><a href="#contenedor-de-docker" class="table-of-contents__link">Contenedor de Docker</a></li></ul></li><li><a href="#preparando-el-ejemplo" class="table-of-contents__link">Preparando el ejemplo</a><ul><li><a href="#base-de-datos" class="table-of-contents__link">Base de datos</a></li><li><a href="#api-en-net" class="table-of-contents__link">API en .NET</a></li><li><a href="#mongodbdriver" class="table-of-contents__link">MongoDB.Driver</a></li></ul></li><li><a href="#repository-pattern" class="table-of-contents__link">Repository Pattern</a></li><li><a href="#sampledal" class="table-of-contents__link">Sample.DAL</a><ul><li><a href="#cortana-crea-un-segundo-proyecto" class="table-of-contents__link">Cortana, crea un segundo proyecto</a></li><li><a href="#instalamos-mongodbdriver-de-nuevo" class="table-of-contents__link">Instalamos MongoDB.Driver, de nuevo</a></li><li><a href="#referencia-dal-en-api" class="table-of-contents__link">Referencia DAL en API</a></li><li><a href="#estructura-del-paquete-dal" class="table-of-contents__link">Estructura del paquete DAL</a></li><li><a href="#mongodb-connecci贸n-e-interfaz" class="table-of-contents__link">MongoDB, Connecci贸n e Interfaz</a></li><li><a href="#entidades" class="table-of-contents__link">Entidades</a></li><li><a href="#iservice-y-manager" class="table-of-contents__link">IService y Manager</a></li></ul></li><li><a href="#dependency-injection" class="table-of-contents__link">Dependency Injection</a></li><li><a href="#crud" class="table-of-contents__link">CRUD</a></li><li><a href="#conclusi贸n" class="table-of-contents__link">Conclusi贸n</a></li><li><a href="#referencias" class="table-of-contents__link">Referencias</a></li></ul></div></div></div></div></div><footer class="footer footer--dark"><div class="container"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Redes Sociales</div><ul class="footer__items"><li class="footer__item"><a href="https://twitter.com/mariomenjr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.youtube.com/channel/UCj7lTb03SFIz-YMm9AlI-SA" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>YouTube<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://github.com/mariomenjr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">M谩s</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/mariomenjr/mariomenjr" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>GitHub<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_3J9K"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">Copyright 漏 2021 Mario Menj铆var. Hecho con Docusaurus.</div></div></div></footer></div>
<script src="/assets/js/runtime~main.4360e302.js"></script>
<script src="/assets/js/main.6f1a4f9f.js"></script>
</body>
</html>