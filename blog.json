[{"author":"Mario Menj√≠var","slug":"como-validar-formularios-en-react-sin-lagrimas","title":"C√≥mo validar formularios en React, sin l√°grimas","timestamp":"2020-09-04T07:08:02.000-07:00","brief":"Hist√≥ricamente, validar un formulario en React requiere de una cantidad impresionante de boilerplate que a√±ade complejidad innecesaria. Veamos c√≥mo librarnos de eso.","keywords":"formik,espa√±ol,react,c√≥mo,validar formularios react,binaria,blog","cover":"https://imgur.com/wm6iA0l.png","endpoint":"2020/09/04/como-validar-formularios-en-react-sin-lagrimas","content":"\n# C√≥mo validar formularios en React, sin l√°grimas\n\nTodos los desarrolladores de software que trabajamos con React, absolutamente todos, hemos tenido ese tedioso ticket para crear y/o validar un formulario. Afortunadamente para ti, hoy te mostrar√© la forma m√°s sencilla de cerrarlo: Formik.\n\n## Formik what?\n\n[Formik](https://formik.org/docs/overview) es uno de los paquetes de software de c√≥digo abierto m√°s √∫tiles que podemos encontrar en el repositorio de `npm` (o `yarn`, como gustes). En palabras de uno de sus creadores, [@JaredPalmer](https://twitter.com/jaredpalmer):\n\n> \"Adm√≠tamoslo, los formularios requiren de much√≠simo c√≥digo en React. Para poner las cosas peor, la mayor√≠a de utilidades para construirlos hacen much√≠sima, demasiada magia que frecuentemente trae un costo al desempe√±o\" de [Formik Docs](https://formik.org/docs/overview)\n\nPara Jared y compa√±√≠a hab√≠a un beneficio en estandarizar los componentes de entrada y c√≥mo los datos flu√≠an a trav√©s del Form. Es la raz√≥n de ser de Formik.\n\n## Preparando el ejemplo\n\nPara ser pr√°cticos, vamos a hacer uso del famos√≠simo toolchain `create-react-app`. Ve a tu l√≠nea de comandos y ejecuta:\n\n```bash\n$ npx create-react-app formik-sample\n$ cd formik-sample\n$ npm start\n```\n\n![React App by create-react-app](https://imgur.com/8tQZ4qO.png)\n\nAhora tenemos la base para trabajar nuestra aplicaci√≥n React, pero necesitamos un form al cu√°l validar, para eso instalaremos el siguiente paquete:\n\n```bash\n$ npm install bootstrap reactstrap --save\n```\n\nEste paquete componetiza la mayor√≠a de utilidades del popular framework CSS Bootstrap, lo cu√°l acelera nuestra habilidad de construir el layout del formulario. Una vez completa la instalaci√≥n, copia y pega este c√≥digo en tu archivo `src/App.js`:\n\n```javascript\n// src/App.js\n\nimport React from \"react\";\nimport {\n  Container,\n  Button,\n  Form,\n  FormGroup,\n  Label,\n  Input,\n  Card,\n  CardBody,\n  CardHeader,\n  FormFeedback,\n} from \"reactstrap\";\n\nfunction Formulario() {\n  return (\n    <Container className=\"p-5\">\n      <Card>\n        <CardHeader></CardHeader>\n        <CardBody>\n          <Form>\n            <h1>Form</h1>\n            <FormGroup>\n              <Label for=\"name\">Name</Label>\n              <Input type=\"text\" name=\"name\" placeholder=\"Woody Allen\" />\n            </FormGroup>\n            <FormGroup>\n              <Label for=\"email\">Email</Label>\n              <Input\n                type=\"email\"\n                name=\"email\"\n                placeholder=\"contoso@domain.com\"\n              />\n            </FormGroup>\n            <FormGroup>\n              <Label for=\"password\">Password</Label>\n              <Input\n                type=\"password\"\n                name=\"password\"\n                placeholder=\"Provide a password\"\n              />\n            </FormGroup>\n            <FormGroup>\n              <Label for=\"bio\">Text Area</Label>\n              <Input type=\"textarea\" name=\"bio\" />\n            </FormGroup>\n\n            <Button type=\"submit\">Submit</Button>\n          </Form>\n        </CardBody>\n      </Card>\n    </Container>\n  );\n}\n\nexport default Formulario;\n```\n\nTambi√©n, a√±ade est√° l√≠nea en el archivo `src/index.js`:\n\n```javascript\n// src/index.js\n\nimport React from 'react';\nimport ReactDOM from 'react-dom';\nimport 'bootstrap/dist/css/bootstrap.css'; // Importa bootstrap a la React App\n// ...\n```\n\nDeber√≠as ver un formulario similar al de la imagen:\n\n![Form built with reactstrap](https://imgur.com/6NWfclG.png)\n\nContinuemos.\n\n## Formik\n\nLlegados a este punto, ya estamos listos para ver la magia de Formik.\n\n```bash\n$ npm install formik --save\n```\n\nYa que la instalaci√≥n haya finalizado, vamos a hacer unas modificaciones a nuestro c√≥digo en `src/App.js`.\n\n```javascript\n// src/App.js\n\nimport React from \"react\";\nimport { Formik } from \"formik\"; // Importamos el component <Formik />\nimport {\n  Container,\n// ...\n```\n\nEste componente debe encapsular a nuestro formulario, c√≥mo se muestra abajo. Formik se mantiene al tanto del estado del formulario y te provee valores, m√©todos reusables y manejadores de eventos a trav√©s de `props`.\n\nAdem√°s, Formik sigue una regla b√°sica para simplificar el proceso de validaci√≥n. Para que la librer√≠a puede relacionar un `initialValues` a un `<Input>` espec√≠fico, tanto la propiedad como el `name` de `<Input>` deben tener el mismo nombre. En el ejemplo de abajo, hemos definido 5 controles: `name`, `email`, `password`, `bio`, and `multiple`.\n\nAunque no debemos olvidar que estamos en React, por lo qu√© debemos manejar el cambio de los valores de los controles. Esto lo logramos con los manejadores provistos por Formik: `handleChange` y `handleBlur`. Sin olvidar que debemos renderizar el valor adecuado en el control, para eso haremos uso de la propiedad `values`.\n\nAparte de las √∫tiles `props` provistas por Formik, tambi√©n el tag en s√≠ mismo necesita de ciertas propiedades para funcionar:\n\n- `initialValues`: Le dice a Formik de cuales valores debe mantenerse al tanto y buscar sus respectivos controles en el formulario.\n- `validate`: Esta funci√≥n recibe como parametro los `values` de los cu√°les la librer√≠a est√° al tanto para ser validados.\n- `onSubmit`: Quiz√° la funci√≥n que m√°s te interese de la librer√≠a. Es aqu√≠ d√≥nde definimos que debe suceder si nuestro formulario ha sido validado con √©xito. Por ejemplo, postear los valores a un servicio del backend.\n\nYa qu√© hemos cubierto una breve explicaci√≥n, es hora de ver todo esto en c√≥digo.\n\n```javascript\n// src/App.js\n\n// ...\nfunction Formulario() {\n  return (\n    <Container className=\"p-5\">\n      <Card>\n        <CardHeader></CardHeader>\n        <CardBody>\n          <Formik\n            initialValues={{\n              name: \"\",\n              email: \"\",\n              password: \"\",\n              bio: \"\",\n            }}\n            validate={(values) => {\n              const errors = {};\n\n              // We need a name\n              if (!values.name) errors.name = \"Required\";\n\n              // We need a valid e-mail\n              if (!values.email) errors.email = \"Required\";\n              else if (!/^[A-Z0-9._%+-]+@[A-Z0-9.-]+\\.[A-Z]{2,}$/i.test(values.email))\n                errors.email = \"Invalid email address\";\n\n              // We need a valid password\n              if (!values.password) errors.password = \"Required\";\n              else if (`${values.password}`.length < 7)\n                errors.password =\n                  \"Password must be larger than 7 characters\";\n\n              console.log({ values, errors });\n\n              return errors;\n            }}\n            onSubmit={(values, { setSubmitting }) => {\n              setTimeout(() => {\n                alert(JSON.stringify(values, null, 2));\n\n                setSubmitting(false);\n              }, 250);\n            }}\n          >\n            {(props) => {\n              const {\n                values,\n                errors,\n                touched,\n                handleChange,\n                handleBlur,\n                handleSubmit,\n                isSubmitting,\n                /* y otras m√°s */\n              } = props;\n              return (\n                <Form onSubmit={handleSubmit}>\n                  <h1>Form</h1>\n                  <FormGroup>\n                    <Label for=\"name\">Name</Label>\n                    <Input\n                      type=\"text\"\n                      name=\"name\"\n                      placeholder=\"Woody Allen\"\n                      invalid={errors.name && touched.name}\n                      onChange={handleChange}\n                      onBlur={handleBlur}\n                      value={values.name}\n                    />\n                    <FormFeedback>{errors.name}</FormFeedback>\n                  </FormGroup>\n                  <FormGroup>\n                    <Label for=\"email\">Email</Label>\n                    <Input\n                      type=\"email\"\n                      name=\"email\"\n                      placeholder=\"contoso@domain.com\"\n                      invalid={errors.email && touched.email}\n                      onChange={handleChange}\n                      onBlur={handleBlur}\n                      value={values.email}\n                    />\n                    <FormFeedback>{errors.email}</FormFeedback>\n                  </FormGroup>\n                  <FormGroup>\n                    <Label for=\"password\">Password</Label>\n                    <Input\n                      type=\"password\"\n                      name=\"password\"\n                      placeholder=\"Provide a password\"\n                      invalid={errors.password && touched.password}\n                      onChange={handleChange}\n                      onBlur={handleBlur}\n                      value={values.password}\n                    />\n                    <FormFeedback>{errors.password}</FormFeedback>\n                  </FormGroup>\n                  <FormGroup>\n                    <Label for=\"bio\">Text Area</Label>\n                    <Input\n                      type=\"textarea\"\n                      name=\"bio\"\n                      onChange={handleChange}\n                      onBlur={handleBlur}\n                      value={values.name}\n                    />\n                  </FormGroup>\n\n                  <Button type=\"submit\" disabled={isSubmitting}>\n                    {isSubmitting ? `Loading` : `Submit`}\n                  </Button>\n                </Form>\n              );\n            }}\n          </Formik>\n        </CardBody>\n      </Card>\n    </Container>\n  );\n}\n// ...\n```\n\nEl c√≥digo de arriba nos permite validar el nombre, e-mail y contrase√±a en nuestro formulario. Al hacer clic en `Submit`, sin completar un solo `<Input>`, deber√≠as ver algo similar a esto:\n\n![Formulario validado](https://imgur.com/IIVx4c9.png)\n\nListo, ya hemos validado el formulario. Lo √∫nico que nos queda es definir el manejador `onSubmit` en el tag `Formik` y tendremos la certeza de qu√© si nuestro programa ejecuta ese `callback` se debe a que nuestros datos han sido previamente validados.\n\n## Podemos hacerlo mejor\n\nSeguramente tienes alguna de estas preguntas en tu cabeza: ¬øPor qu√© repetir la asignaci√≥n de `handleChange` y `handleBlur`? y ¬øPor qu√© validar _manualmente_ cada propiedad paso a paso?. Cre√©me, yo tambi√©n me hice esas preguntas.\n\nPara fortuna de qui√©n tenga que mantener este formulario, hay una forma m√°s sencilla de definir las validaci√≥n y los controles de estado.\n\n### Formik Field\n\nPara reducir el n√∫mero de veces que repetimos la asignaci√≥n de los manejadores de eventos, vamos a importar otro elemento de la librer√≠a Formik.\n\n```javascript\n// src/App.js\n\n// ...\nimport { Formik, Field } from \"formik\"; // Importamos el component <Field />\n// ...\n```\n\nEste componente nos permite ahorrarnos la asignaci√≥n de manejadores y valor directamente al componente. Lo √∫nico que debemos hacer, y ya que estamos usando `reacstrap`, es asignarlo a la propiedad `tag` de cada elemento `<Input>`. Formik se encargar√° del resto.\n\n```javascript\n<Input\n  type=\"text\"\n  name=\"name\"\n  placeholder=\"Woody Allen\"\n  invalid={errors.name && touched.name}\n- onChange={handleChange}\n- onBlur={handleBlur}\n- value={values.name}\n+ tag={Field}\n/>\n```\n\nEs imprescindible que la propiedad `name` del `<Input>` tenga el mismo nombre a una propiedad en `initialValues`.\n\n### Formik + Yup\n\n[`Yup`](https://github.com/jquense/yup) es una librer√≠a que nos permite construir esquemas de conversi√≥n y validaci√≥n. El punto m√°s fuerte de `Yup` es el n√≠vel de expresividad que las validaciones pueden alcanzar, sencillas o complejas.\n\nDe acuerdo a la [documentaci√≥n](https://formik.org/docs/guides/validation#validationschema) de `Formik`, `Yup` es un ciudadano de primera clase en la librer√≠a por lo que posee una `prop` especial en el elemento `<Formik>` llamada `validationSchema`.\n\n```bash\n$ npm install yup --save\n```\n\nUna vez instalamos `Yup`, debemos importarlo:\n\n```javascript\n// src/App.js\n\n// ...\nimport * as Yup from \"yup\"; // Importando Yup\nimport {\n  Container,\n// ...\n```\n\nRegresemos al c√≥digo del componente `Formulario`. Justo en la propiedades del elmento `<Formik>` vamos a eliminar la propiedad `validate` y en su lugar asignaremos la propiedad `validationSchema`.\n\n```javascript\n<Formik\n  initialValues={{\n    name: \"\",\n    email: \"\",\n    password: \"\",\n    bio: \"\",\n  }}\n  validationSchema={Yup.object().shape({\n    name: Yup.string().required(\"Required\"),\n    email: Yup.string().email(\"Invalid email\").required(\"Required\"),\n    password: Yup.string().min(8, \"Password is too short\").required(\"Required\"),\n  })}\n  onSubmit={(values, { setSubmitting }) => {\n    setTimeout(() => {\n      alert(JSON.stringify(values, null, 2));\n\n      setSubmitting(false);\n    }, 250);\n  }}\n>\n```\n\nPor √∫ltimo, podemos llenar nuestro formulario y ver que una vez validado, el `callback` en la propiedad `onSubmit` del elemento `<Formik>` es ejecutada.\n\n![Formulario completo](https://imgur.com/wm6iA0l.png)\n\n## Conclusi√≥n\n\nEspero este post te sea de mucha ayuda. En mi experiencia con React, Formik me ha facilitado el validar formularios al proveerme de m√©todos que me permiten ajustar a cada momento los valores y las validaciones necesarias. La expresividad del c√≥digo es de gran valor ya que permite escalar y/o mantener de una forma sencilla sin reinventar la rueda para cada formulario.\n\n## Referencias\n\n- [Formik documentation](https://formik.org/docs/overview)"},{"author":"Mario Menj√≠var","slug":"algoritmos-busqueda-binaria","title":"#Algoritmos: B√∫squeda binaria","timestamp":"2020-08-14T09:47:12.000-07:00","brief":"A qu√© alguna vez te toco buscar un n√∫mero de tel√©fono en aquellos gigantescos directorios tel√©fonicos, ¬øC√≥mo le hac√≠as, p√°gina por p√°gina o te tratabas de ahorrar tiempo salt√°ndote p√°ginas?","keywords":"algoritmos,computer,science,busqueda,binaria,blog,ciencias,computacion","cover":"https://upload.wikimedia.org/wikipedia/commons/f/f7/Binary_search_into_array.png","endpoint":"2020/08/14/algoritmos-busqueda-binaria","content":"\n# \\#Algoritmos: B√∫squeda binaria\n\nA qu√© alguna vez te toco buscar un n√∫mero de tel√©fono en aquellos gigantescos directorios tel√©fonicos, ¬øC√≥mo le hac√≠as, p√°gina por p√°gina o tratabas de ahorrar tiempo salt√°ndote p√°ginas?\n\n## La idea\n\nRetomando el gigantesco directorio tel√©fonico, podemos estar seguros de una cosa: los n√∫meros de tel√©fono se presentan en orden alfab√©tico por el nombre del propietario. Esto es es imprecindible para el algoritmo de b√∫squeda binaria. \n\nSuponiendo que buscamos el n√∫mero tel√©fonico de Juan, ¬øTiene sentido empezar desde las primeras p√°ginas d√≥nde estar√°n los n√∫meros de personas c√≥mo Alberto o Alejandra? Si tu respuesta es no, est√°s en lo correcto, ser√° much√≠simo m√°s f√°cil identificar en cu√°l p√°gina empiezan a listarse los nombres que inician con J, y empezar nuestra b√∫squeda desde ah√≠. Una vez en esta p√°gina, podr√≠amos incluso tratar de id√©ntificar en cu√°l p√°gina empiezan a listarse los nombres que empiezan con Ju, y as√≠ sucesivamente hasta encontrar a Juan.\n\n## En c√≥digo\n\nPero en este blog nosotros ya no usamos esos gigantescos directorios tel√©fonicos, as√≠ que vamos a ver un ejemplo m√°s acorde a lo que sabemos hacer aqu√≠: c√≥digo. Por lo qu√© para nuestro ejemplo pr√°ctico, vamos a validar si un n√∫mero `X` est√° inclu√≠do dentro de una lista de `N` elementos.\n\nComo mencionamos antes en el ejemplo del directorio, pod√≠amos estar seguros de una cosa: sus datos est√°n ordenados. Esto se mantiene a la hora de utilizar c√≥digo. Nuestro arreglo de datos debe estar ordenado. Sino lo est√°, debemos ordenarlo. Eso lo dejaremos para futuros posts.\n\nEsta ser√° nuestra lista de trabajo:\n\n```javascript\nconst numbers = [2, 3, 5, 9, 15, 17, 55, 69];\n```\n\nPara ejecutar de manera efectiva el algoritmo, necesitaremos tener la noci√≥n del mayor y menor n√∫mero en nuestra lista, y ya qu√© no hay mejor manera de localizar valores en una lista que usar su indice, guardaremos eso, los indices:\n\n```javascript\nlet maxIndex = numbers.length - 1;\nlet minIndex = 0;\n```\n\n¬øRecuerdas como en el ejemplo del directorio, tratabamos de identificar la p√°gina en la cu√°l los nombres que inician con J empezaban a listarse? Al aplicar el algoritmo de b√∫squeda binaria tomamos un enfoque m√°s general. Esto significa que nosotros siempre dividiremos la lista por la mitad y, partiendo de una comparaci√≥n, definiremos a cu√°l de las dos mitades pertence el valor que deseamos encontrar. Una vez conozcamos la mitad a la qu√© pertenece, repetimos el proceso y as√≠ sucesivamente hasta que nuestra √°rea de b√∫squeda se reduce a uno, o simplemente no encontramos el valor.\n\n> ![B√∫squeda binaria](https://upload.wikimedia.org/wikipedia/commons/f/f7/Binary_search_into_array.png)\n> Este es el esquema del funcionamiento del algoritmo de [Wikipedia](https://es.wikipedia.org/wiki/B%C3%BAsqueda_binaria)\n\nAntes de ejemplificar lo anterior, nos queda mostrar c√≥mo identificaremos la mitad de nuestra lista:\n\n```javascript\nlet half = Math.floor((minIndex + maxIndex)/2);\n```\n\nAhora s√≠, armemos el algoritmo:\n\n```javascript\nconst find = 17;\nconst numbers = [2, 3, 5, 9, 15, 17, 55, 69];\n\nfunction busquedaBinaria(collection, findee) {\n  // Asignando los valores del rango inicial\n  let minIndex = 0;\n  let maxIndex = numbers.length - 1;\n\n  while (minIndex <= maxIndex) {\n    \n    // Calculando la posici√≥n en el medio de la lista\n    let half = Math.floor((minIndex + maxIndex) / 2);\n\n    // Recoger el valor del medio\n    let guess = collection[half];\n\n    if (guess === findee) // Comparamos si es el valor que buscamos\n      return half;\n\n    else if (guess > findee) \n      // Si el valor que buscamos es menor al valor supuesto\n      // debemos reducir nuestro rango de b√∫squeda.\n      // Ahora nuestro mayor valor est√° justo debajo de la mitad calculada.\n      maxIndex = half - 1; \n    \n    else \n      // Si el valor que buscamos es mayor al valor supuesto\n      // debemos reducir nuestro rango de b√∫squeda.\n      // Ahora nuestro menor valor est√° justo arriba de la mitad calculada.\n      minIndex = half + 1;\n  }\n  return -1;\n}\n\nconst foundIndex = busquedaBinaria(numbers, find);\nconsole.log(\n  foundIndex === -1\n    ? `El n√∫mero ${find} no fue encontrado.`\n    : `El n√∫mero ${find} est√° en el √≠ndice ${foundIndex}.`\n);\n```\n\nEs esta din√°mica de decidir √∫nicamente entre dos opciones, cada vez que reducimos el √°rea de b√∫squeda, lo qu√© le da el nombre algoritmo.\n\n# Conclusi√≥n\n\nPudimos simplemente ejecutar el siguiente c√≥digo:\n\n```javascript\nconst find = 17;\nconst numbers = [2, 3, 5, 9, 15, 17, 55, 69];\n\nlet foundIndex = -1;\n\nfor (let index = 0; index < numbers.length; index++) {\n  if (find === numbers[index]) {\n    foundIndex = index;\n    break;\n  }\n}\n\nconsole.log(\n  foundIndex === -1\n    ? `El n√∫mero ${find} no fue encontrado.`\n    : `El n√∫mero ${find} est√° en el √≠ndice ${foundIndex}.`\n);\n```\n\nComparar cada uno de los `items` en la lista y, cuando lo encontramos, listo. Podr√≠as pensar que es enfoque es much√≠simo m√°s f√°cil y r√°pido de programar, y tienes raz√≥n. Pero, ¬øQu√© pasa cuando nuestra lista no contiene 8 `items` sino 1,000,000?\n\nLa intenci√≥n de este post es mostrarte que, si bien es cierto en programaci√≥n hay muchas formas de resolver un problema, nuestro objetivo conforme avanzamos en nuestra carrera es escogar la m√°s √≥ptima. Cada problema es un mundo y es nuestro trabajo encontrar la mejor soluci√≥n.\n\n# Referencias\n\n- [Binary search algorithm from Wikipedia](https://en.wikipedia.org/wiki/Binary_search_algorithm)\n- [Grokking Algorithms: An Illustrated Guide For Programmers and Other Curious People](https://www.goodreads.com/book/show/22847284-grokking-algorithms-an-illustrated-guide-for-programmers-and-other-curio)"},{"author":"Mario Menj√≠var","slug":"como-crear-un-blog-a-base-de-markdown-y-javascript","title":"C√≥mo crear un blog a base de markdown y JavaScript","timestamp":"2020-08-09T10:23:17.000-07:00","brief":"Seguramente te haz hecho la siguiente pregunta: ¬øC√≥mo hostear un blog que sea f√°cil de mantener, sin pagar un centavo? En este post te explico una de tantas alternativas.","keywords":"javascript,svelte,blog,markdown,howto","endpoint":"2020/08/09/como-crear-un-blog-a-base-de-markdown-y-javascript","content":"\n# C√≥mo crear un blog a base de markdown y JavaScript\n\nSeguramente te haz hecho la siguiente pregunta: ¬øC√≥mo hostear un blog que sea f√°cil de mantener, sin pagar un centavo? En este post te explico una de tantas alternativas.\n\n## Porqu√©\n\nOtra pregunta que probablemente este en tu cabeza es ¬øPor qu√© markdown y JavaScript? La respuesta es un poco m√°s elaborada. Para empezar, ¬øQu√© es markdown? Seg√∫n Wikipedia: \n\n> \"Markdown es un lenguaje de marcado ligero que trata de conseguir la m√°xima legibilidad y facilidad de publicaci√≥n tanto en su forma de entrada como de salida, inspir√°ndose en muchas convenciones existentes para marcar mensajes de correo electr√≥nico usando texto plano\" de [Wikipedia](https://es.wikipedia.org/wiki/Markdown).\n\nAl usar markdown para escribir un post, estamos estructurando nuestro contenido sin necesidad de incluir HTML o CSS en el momento. Es decir, nos enfocamos enteramente en lo importante: el texto. Esta simplicidad se ver√° potencializada al incluir _Git_ y _Github_ en la formula, ya que podremos versionar nuestro contenido.\n\nComo mencion√©, hay muchas alternativas para lograrlo. Fundamentalmente una p√°gina web no es m√°s que HTML, CSS y JavaScript. Herramientas como [_Jekyll_](https://jekyllrb.com/), aprovechan esta regla de oro para ayudarte a generar y administrar posts f√°cilmente haciendo uso de markdown. Pero, ¬øQu√© pasa si queremos tomar ventaja de todas las herramientas disponibles en el ecosistema JavaScript que se han establecido en los √∫ltimos 10 a√±os?  Para eso tenemos [_Gatsby_](https://www.gatsbyjs.org/), [_Next.js_](https://nextjs.org/) o [_Sapper_](https://sapper.svelte.dev/docs).\n\n_In a nutshell_, estos tres frameworks permiten generar sitios est√°ticos haciendo uso de herramientas modernas como React o Svelte. En este post nos centraremos en _Sapper_.\n\n## ¬øPor qu√© _Sapper_?\n\nSvelte es el nuevo chico de la cuadra. Su propuesta insignia es mover la reactividad de la UI desde mediadores como el Virtual DOM hacia el lenguaje, o mejor dicho, al compilador, en contraste con React o Vue. Esto aumenta el desempe√±o de las aplicaciones y disminuye el tama√±o del _bundle_.\n\nPuedes echar un vistazo a la [comparativa](https://www.swyx.io/writing/svelte-static/) entre Gatsby y Sapper realizada por [Shawn Wang](https://twitter.com/swyx), un popular desarrollador en [egghead.io](https://egghead.io/). Se muestra una reducci√≥n del 93% en el tama√±o del _bundle_ con _Sapper_.\n\n## Setup\n\nPara instalar Sapper, basta con ejecutar los siguientes comandos:\n\n```bash\n[user@host ~]$ npx degit \"sveltejs/sapper-template#rollup\" my-blog\n[user@host ~]$ cd my-blog\n[user@host my-blog]$ npm install\n[user@host my-blog]$ npm run dev\n```\n\nEn el folder del projecto _my-blog_, nos interesan los siguientes files:\n\n```text\n...\n‚îú src\n‚îÇ ‚îú routes\n| | ‚îú blog\n| | | ‚îú _posts.js\n| | | ‚îú [slug].json.js\n| | | ‚îú [slug].svelte\n| | | ‚îú index.json.js\n| | | ‚îú index.svelte\n...\n```\n\nDe paso creamos el siguiente directorio y archivo:\n\n```text\n...\n+ ‚îú content\n+ ‚îÇ ‚îú 2020-08-08_hola-mundo.md\n  ‚îú src\n  ‚îÇ ‚îú routes\n...\n```\n\nCon el siguiente contenido:\n\n```text\n---\nauthor: 'Mario Menj√≠var'\nslug: 'hola-mundo'\ntitle: 'Hola Mundo'\ntimestamp: '2020-08-08T10:23:17.000-07:00'\n---\n\n# Hola mundo\n\nHola mundo.\n```\n\nNecesitamos instalar los siguientes paquetes:\n\n```bash\n[user@host my-blog]$ npm i gray-matter highlight.js marked\n```\n\nEn mi caso, quiero que los posts est√©n ordenados por su fecha de publicaci√≥n y que esto se refleje en la URL. Tendremos que hacer unos cambios a los siguientes archivos:\n\n```text\n...\n- | | | ‚îú [slug].json.js\n- | | | ‚îú [slug].svelte\n+ | | | ‚îú [...slug].json.js\n+ | | | ‚îú [...slug].svelte\n...\n```\n\nLuego, reemplazamos el contenido:\n\n```javascript\n// src/routes/blog/[...slug].json.js\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport marked from \"marked\";\nimport hljs from \"highlight.js\";\nimport grayMatter from \"gray-matter\";\n\n/*\n * Para obtener el contenido del post\n */\nfunction getPost(year, month, day, fileName) {\n  return fs.readFileSync(\n    path.resolve(\"content\", `${year}-${month}-${day}_${fileName}.md`),\n    \"utf-8\"\n  );\n}\n\n/*\n * En Sapper, este m√©todo responde a una request a trav√©s del m√©todo GET\n * En nuestro caso, la request de un JSON\n */\nexport function get(req, res, next) {\n  // As√≠ es c√≥mo resolvemos una `dynamic route` en Sapper,\n  // obtenemos cada valor en su variable respectiva\n  let [year, month, day, slug] = req.params.slug;\n\n  const postMarkdown = getPost(year, month, day, slug);\n  const renderer = new marked.Renderer();\n\n  // marked provee una manera de formatear partes espec√≠ficas del markdown\n  // en este caso, el c√≥digo\n  renderer.code = (source, lang) => {\n    const { value: highlighted } = hljs.highlight(lang, source);\n    return `<pre class='language-${lang} overflow-x-auto'><code>${highlighted}</code></pre>`;\n  };\n\n  marked.use({ renderer });\n\n  const { data, content } = grayMatter(postMarkdown);\n  const html = marked(content);\n\n  if (html) {\n    res.writeHead(200, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ html, ...data }));\n  } else {\n    res.writeHead(404, { \"Content-Type\": \"application/json\" });\n    res.end(JSON.stringify({ message: `Not found` }));\n  }\n}\n```\n```html\n<!-- src/routes/blog/[...slug].svelte -->\n\n<script context=\"module\">\n  /*\n   * Este m√©todo representa un paso en el ciclo de vida de un component en Sapper.\n   *\n   * √önicamente se ejecuta cuando el componente es montado. Aqu√≠ haremos la petici√≥n de nuestro JSON con la informaci√≥n del post\n   */\n  export async function preload({ params }) {\n    let [year, month, day, slug] = params.slug;\n\n    const res = await this.fetch(`blog/${year}/${month}/${day}/${slug}.json`);\n    const data = await res.json();\n\n    if (res.status === 200) {\n      return { post: data };\n    } else {\n      this.error(res.status, data.message);\n    }\n  }\n</script>\n\n<script>\n  export let post;\n</script>\n\n<svelte:head>\n  <title>{post.title} by {post.author}</title>\n</svelte:head>\n\n<article>\n  {@html post.html}\n</article>\n```\n\nDe esta forma se renderizar√° el post. Ya puedes verlo en tu ambiente local yendo a [/blog/2020/08/08/hola-mundo](http://localhost:3000/blog/2020/08/08/hola-mundo).\n\nA√∫n hay un peque√±o detalle que debemos cubrir para cumplir con las reglas que _Sapper_ establece si queremos exportar nuestro peque√±o blog como un sitio est√°tico.\n\n> \"... cualquier p√°gina que quieras que sea inclu√≠da en el sitio (est√°tico) exportado debe ser esta ligado con una etiqueta del tipo \\<a\\> o a√±adida c√≥mo parametro de la opci√≥n  --entry del comando `sapper export`\" de [Sapper docs](https://sapper.svelte.dev/docs#How_it_works).\n\nDe acuerdo a la documentaci√≥n, debemos incluir elementos **\\<a\\>** que apunten a nuestras p√°ginas generadas a partir de rutas din√°micas, para que al exportar el sitio estas tambi√©n se incluyan. Por eso programaremos el endpoint [/blog](http://localhost:3000/blog).\n\n```javascript\n// src/routes/blog/index.json.js\n\nimport fs from \"fs\";\nimport path from \"path\";\nimport grayMatter from \"gray-matter\";\n\nfunction getAllPosts() {\n  const posts = fs\n    .readdirSync(\"content\")\n    .map((fileName) => {\n      const post = fs.readFileSync(path.resolve(\"content\", fileName), \"utf-8\");\n      return grayMatter(post).data;\n    })\n    .sort((a, b) => {\n      if (b.timestamp < a.timestamp) return -1;\n      if (b.timestamp > a.timestamp) return 1;\n\n      return 0;\n    });\n  return posts;\n}\n\nexport function get(req, res) {\n  res.writeHead(200, { \"Content-Type\": \"application/json\" });\n  res.end(JSON.stringify(getAllPosts()));\n}\n```\n```html\n<!-- src/routes/blog/index.svelte -->\n\n<script context=\"module\">\n  export function preload({ params, query }) {\n    return this.fetch(`blog.json`)\n      .then((r) => r.json())\n      .then((posts) => ({\n        posts: posts.map((post) => {\n          const timestamp = new Date(post.timestamp);\n          return {\n            ...post,\n            timestamp,\n            date: {\n              year: timestamp.getFullYear(),\n              month: `${timestamp.getMonth() + 1}`.padStart(2, `0`),\n              day: `${timestamp.getDate()}`.padStart(2, `0`),\n            },\n          };\n        }),\n      }));\n  }\n</script>\n\n<script>\n  export let posts;\n</script>\n\n<svelte:head>\n  <title>Blog | Mario Menj√≠var</title>\n</svelte:head>\n\n<ul>\n  {#each posts as post}\n  <li>\n    <a\n      rel=\"prefetch\"\n      href=\"blog/{post.date.year}/{post.date.month}/{post.date.day}/{post.slug}\"\n    >\n      {post.title}\n    </a>\n    <p class=\"blog-timestamp\">\n      Posted on {post.timestamp.toLocaleString()} by {post.author}\n    </p>\n  </li>\n  {/each}\n</ul>\n```\n\nListo.\n\n## Sitio est√°tico\n\nAntes de desplegar nuestro fant√°stico blog, necesitamos asegurarnos que las p√°ginas est√°ticas se generaran sin problemas. Para eso necesitamos ejecutar lo siguiente en la l√≠nea de comandos:\n\n```bash\n[user@host my-blog]$ npm run export\n[user@host my-blog]$ npx serve __sapper__/export\n```\n\nSi no tienes ningun problema al acceder a este endpoint [/blog/2020/08/08/hola-mundo](http://localhost:5000/blog/2020/08/08/hola-mundo), ¬°Felicidades! solo nos queda desplegar el sitio.\n\n\n## Despliegue: Github Pages\n\nNuestro sitio est√°tico ha sido generado y los archivos est√°n dentro de la carpeta `__sapper__/export`. Existen una infinidad de servicios que te permiten almacenar y servir este tipo de sitios, entre los m√°s populares tenemos Netlify o Github Pages. En este post te mostrar√© c√≥mo hacerlo con _Github Pages_.\n\nPodr√≠amos subir el folder `__sapper__/export` a un nuevo repositorio, activar la opci√≥n _Github Pages_ y repetir este proceso manualmente cada vez que actualicemos nuestro sitio con un nuevo post. En mi opini√≥n, hacerlo de manera manual le quita la diversi√≥n. Afortunadamente, exite _Github Actions_.\n\nEl primer paso es crear dos repositorios en _Github_, el primero es el repositorio de nuestro projecto y el segundo el repositorio al cu√°l subiremos nuestro sitio est√°tico. En mi caso, [mariomenjr/mariomenjr](https://github.com/mariomenjr/mariomenjr) y [mariomenjr/mariomenjr.github.io](https://github.com/mariomenjr/mariomenjr.github.io) respectivamente. Una vez hecho esto, creamos los siguientes folders y archivos en el folder del projecto:\n\n```text\n...\n‚îú .github\n‚îÇ ‚îú workflows\n| | | deploy.yml\n‚îú src\n...\n```\n```yml\n# .github/workflows/deploy.yml\n\nname: Build and deploy\non:\n    push:\n      branches: \n        # √önicamente cuando actualicemos master\n        - master\njobs:\n  build-and-deploy:\n    runs-on: ubuntu-latest\n    steps:\n      - name: Checkout üõéÔ∏è\n        uses: actions/checkout@v2.3.1\n        with:\n          persist-credentials: false\n      - name: Install and build\n        run: |\n          npm install\n          npm run export\n      - name: Deploy üöÄ\n        uses: JamesIves/github-pages-deploy-action@3.5.9\n        with:\n          # Limpiar√° el despliegue previo\n          CLEAN: true\n          # Necesitamos crear este secret para el repositorio\n          GITHUB_TOKEN: ${{ secrets.DEPLOY_MARIOMENJR }}\n          BRANCH: master\n          FOLDER: __sapper__/export\n          BASE_BRANCH: master\n          REPOSITORY_NAME: mariomenjr/mariomenjr.github.io\n\n```\n\nEl archivo anterior se explica en la [documentaci√≥n](https://github.com/marketplace/actions/deploy-to-github-pages) de la acci√≥n. En este post nos centraremos en un l√≠nea 1 l√≠nea: \n\n```yml\n...\njobs:\n  build-and-deploy:\n    ...\n    steps:\n      ...\n      - name: Deploy üöÄ\n        ...\n        with:\n          ...\n          # Necesitamos crear este secret para el repositorio\n          GITHUB_TOKEN: ${{ secrets.DEPLOY_MARIOMENJR }}\n          ...\n```\n\nEs esta l√≠nea la que autoriza a la acci√≥n a hacer cambios al repositorio `mariomenjr/mariomenjr.github.io`.\n\nPara generar tu _Github token_, dir√≠gete a [github.com/settings/tokens](https://github.com/settings/tokens), haz clic en el bot√≥n `Generate new token`, escribe un nombre significativo en el campo `Note`, selecciona el _checkbox_ **_repo_** y, por √∫ltimo, haz clic en el bot√≥n `Generate token`.\n\n![Github personal access tokens](https://imgur.com/HbbMgm7.png)\n\nNo olvides copiar el token.\n\nPor √∫ltimo, dir√≠gete al repositorio del projecto para crear la variable de entorno que incluir√°s en el archivo `deploy.yml`.\n\n![Add secret to repository](https://imgur.com/iuyGLdc.png)\n\n```yml\n...\njobs:\n  build-and-deploy:\n    ...\n    steps:\n      ...\n      - name: Deploy üöÄ\n        ...\n        with:\n          ...\n          # Necesitamos crear este secret para el repositorio\n          GITHUB_TOKEN: ${{ secrets.MI_VARIABLE }}\n          ...\n```\n\nListo. Tan pronto hagas push al repositorio del projecto, _Github Actions_ desplegar√° tu sitio est√°tico.\n\n![Github Action Deployment](https://imgur.com/fHxzGuf.png)\n\nNo olvides activar la opci√≥n Github Pages en el repositorio al que desplegaste el sitio.\n\n![Settings](https://imgur.com/tkl8wSO.png)\n\n![Github Pages Setting](https://imgur.com/86osvtX.png)\n\n# Conclusi√≥n\n\nPuedes usar WordPress, Ghosts, incluso Jekyll si lo prefieres. El objetivo de este post es mostrarte como todas esas herramientas tienen su origen en cosas b√°sicas que con el tiempo se convierten en herramientas robustas listas para sacarles provecho.\n\nMe decid√≠ a construir este blog, de esta manera, para poner en pr√°ctica el concepto [Aprender en P√∫blico](https://ricardoerl.com/blog/aprender-en-publico) que present√≥ [Ricardo](https://ricardoerl.com), un desarrollador salvadore√±o, en un charla de [Caf√© Digital](https://twitter.com/cafedigitalsv) y as√≠ salir de mi zona de comfort. Cre√©me cuando te digo que me divert√≠.\n\n\n# Referencias\n\n- [Building a blog with Svelte, Sapper, and Markdown](https://www.mahmoudashraf.dev/blog/build-a-blog-with-svelte-and-markdown/) \n- [Sapper docs](https://sapper.svelte.dev/docs#How_it_works)\n- [Static Svelte: JavaScript Blogging with 93% less JavaScript](https://www.swyx.io/writing/svelte-static/)\n- [Markdown](https://es.wikipedia.org/wiki/Markdown)"}]